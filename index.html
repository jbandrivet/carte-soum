<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G√©n√©rateur d'Image Personnalis√©</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(135deg,#1a1a1a 0%,#2d2d30 50%,#1a1a1a 100%);
    color:#fff;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
}
.container {
    background:rgba(44,44,44,0.95);
    backdrop-filter:blur(10px);
    border-radius:20px;
    box-shadow:0 15px 35px rgba(0,0,0,0.7),0 0 0 1px rgba(255,255,255,0.1);
    padding:30px 40px;
    max-width:650px;
    width:100%;
    border:1px solid rgba(255,0,0,0.3);
    position:relative;
    overflow:hidden;
}
.container::before {
    content:'';
    position:absolute;
    top:0;left:0;right:0;
    height:2px;
    background:linear-gradient(90deg,transparent,#ff0000,transparent);
}
h1 {
    text-align:center;
    margin-bottom:25px;
    font-size:2.5rem;
    background:linear-gradient(45deg,#ff0000,#cc0000);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-shadow:0 0 30px rgba(255,0,0,0.5);
}
.form-group {
    margin-bottom:20px;
}
label {
    display:block;
    margin-bottom:8px;
    font-weight:600;
    color:#e0e0e0;
    font-size:1.1rem;
}
input[type="file"], textarea, select, input[type="text"], input[type="tel"] {
    width:100%;
    padding:12px;
    border:2px solid rgba(255,0,0,0.3);
    border-radius:12px;
    background:rgba(51,51,51,0.8);
    color:#fff;
    font-size:1rem;
    transition:all 0.3s ease;
}
input:focus, textarea:focus, select:focus {outline:none;border-color:#ff0000;box-shadow:0 0 20px rgba(255,0,0,0.3);transform:translateY(-2px);}
textarea {resize:vertical;min-height:80px;font-family:inherit;}
.controls-row {display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
.slider-group {display:flex;flex-direction:column;}
input[type="range"] {width:100%;margin:10px 0;-webkit-appearance:none;appearance:none;height:6px;background:rgba(255,255,255,0.2);border-radius:3px;outline:none;}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;background:#ff0000;border-radius:50%;cursor:pointer;box-shadow:0 0 10px rgba(255,0,0,0.5);}
input[type="range"]::-moz-range-thumb{width:20px;height:20px;background:#ff0000;border-radius:50%;cursor:pointer;border:none;box-shadow:0 0 10px rgba(255,0,0,0.5);}
.color-picker {display:flex;align-items:center;gap:10px;}
input[type="color"] {width:50px;height:40px;border:none;border-radius:8px;cursor:pointer;background:none;}
button {
    width:100%;
    background:linear-gradient(45deg,#ff0000,#cc0000);
    color:#fff;
    padding:16px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-size:1.1rem;
    font-weight:bold;
    transition:all 0.3s ease;
    text-transform:uppercase;
    letter-spacing:1px;
    position:relative;
    overflow:hidden;
    margin-bottom:10px;
}
button::before {
    content:'';
    position:absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);
    transition:left 0.5s ease;
}
button:hover::before {left:100%;}
button:hover {transform:translateY(-2px);box-shadow:0 8px 20px rgba(255,0,0,0.4);}
button:active {transform:translateY(-1px);}
button:disabled {opacity:0.6;cursor:not-allowed;transform:none;}
.preview-container {margin-top:20px;text-align:center;}
#preview {max-width:100%;max-height:500px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5);border:2px solid rgba(255,0,0,0.5);display:none;}
#downloadLink {display:none;margin-top:15px;padding:12px 20px;background:rgba(255,0,0,0.1);color:#ff0000;text-decoration:none;border-radius:8px;font-weight:bold;border:1px solid rgba(255,0,0,0.3);transition:all 0.3s ease;}
#downloadLink:hover {background:rgba(255,0,0,0.2);transform:translateY(-2px);}
.loading {display:none;text-align:center;margin-top:15px;}
.spinner {border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top:3px solid #ff0000;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto;}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.value-display {font-size:0.9rem;color:#ff0000;font-weight:bold;}
@media (max-width:768px){
    .controls-row {grid-template-columns:1fr;}
    .container {padding:20px;margin:10px;}
    h1 {font-size:2rem;}
}
</style>
</head>
<body>
<div class="container">
<h1>G√©n√©rateur d'Image Personnalis√©</h1>
<form id="imageForm">
    <div class="form-group">
        <label for="photos">üì∏ Choisir jusqu'√† 3 photos :</label>
        <input type="file" id="photos" accept="image/*" capture="environment" multiple required>
    </div>
    <div class="form-group">
        <label for="idCard">üÜî Ajouter une carte d'identit√© (facultatif) :</label>
        <input type="file" id="idCard" accept="image/*">
    </div>
    <div class="form-group">
        <label for="firstName">Pr√©nom :</label>
        <input type="text" id="firstName" placeholder="Votre pr√©nom" required>
    </div>
    <div class="form-group">
        <label for="lastName">Nom :</label>
        <input type="text" id="lastName" placeholder="Votre nom" required>
    </div>
    <div class="form-group">
        <label for="phone">Num√©ro de t√©l√©phone :</label>
        <input type="tel" id="phone" placeholder="Ex: +33 6 12 34 56 78" required>
    </div>
    <div class="form-group">
        <label for="social">Profil r√©seau social :</label>
        <input type="text" id="social" placeholder="Ex: @monprofil">
    </div>
    <div class="form-group">
        <label for="info">‚úèÔ∏è Texte personnalis√© :</label>
        <textarea id="info" placeholder="Entrez un message..."></textarea>
    </div>
    <div class="form-group">
        <label for="theme">üé® Choisir un overlay :</label>
        <select id="theme">
            <option value="none">Aucun</option>
            <option value="chains">Cha√Ænes m√©talliques</option>
            <option value="leather">Texture cuir</option>
            <option value="ropes">Cordes entrelac√©es</option>
            <option value="geometric">Motifs g√©om√©triques</option>
            <option value="smoke">Effet fum√©e</option>
        </select>
    </div>
    <div class="controls-row">
        <div class="slider-group">
            <label for="textSize">Taille du texte: <span id="textSizeValue" class="value-display">40px</span></label>
            <input type="range" id="textSize" min="20" max="80" value="40">
        </div>
        <div class="slider-group">
            <label for="overlayOpacity">Opacit√© overlay: <span id="overlayOpacityValue" class="value-display">30%</span></label>
            <input type="range" id="overlayOpacity" min="10" max="80" value="30">
        </div>
    </div>
    <div class="controls-row">
        <div class="color-picker">
            <label for="textColor">Couleur du texte:</label>
            <input type="color" id="textColor" value="#ff0000">
        </div>
        <div class="color-picker">
            <label for="borderColor">Couleur bordure:</label>
            <input type="color" id="borderColor" value="#ff0000">
        </div>
    </div>
    <button type="submit" id="generateBtn">G√©n√©rer l'image</button>
    <button type="button" id="translateBtn">Traduire en anglais</button>
    <button type="button" id="shareBtn">Publier sur X</button>
</form>

<div class="loading" id="loading">
    <div class="spinner"></div>
    <p>G√©n√©ration en cours...</p>
</div>

<div class="preview-container">
    <canvas id="previewCanvas" style="display:none;"></canvas>
    <img id="preview" src="" alt="Image g√©n√©r√©e" />
    <br>
    <a id="downloadLink" href="#" download="image_personnalisee.jpg">‚¨áÔ∏è T√©l√©charger l'image</a>
</div>
</div>

<script>
// Sliders
const textSizeSlider = document.getElementById('textSize');
const textSizeValue = document.getElementById('textSizeValue');
textSizeSlider.addEventListener('input',()=>{textSizeValue.textContent=textSizeSlider.value+'px';});
const overlayOpacitySlider = document.getElementById('overlayOpacity');
const overlayOpacityValue = document.getElementById('overlayOpacityValue');
overlayOpacitySlider.addEventListener('input',()=>{overlayOpacityValue.textContent=overlayOpacitySlider.value+'%';});

// wrap text
function wrapText(ctx,text,x,y,maxWidth,lineHeight){
    const words=text.split(' ');let line='';const lines=[];
    for(let n=0;n<words.length;n++){
        const testLine=line+words[n]+' ';
        const metrics=ctx.measureText(testLine);
        if(metrics.width>maxWidth&&n>0){lines.push(line);line=words[n]+' ';}else{line=testLine;}
    }
    lines.push(line);
    for(let i=0;i<lines.length;i++){ctx.strokeText(lines[i],x,y+i*lineHeight);ctx.fillText(lines[i],x,y+i*lineHeight);}
}

function drawOverlay(ctx,w,h,theme,opacity){
    // Pour l'instant, simple rectangle semi-transparent
    if(theme==='none') return;
    ctx.globalAlpha=opacity/100;
    ctx.fillStyle='rgba(255,0,0,0.2)';
    ctx.fillRect(0,0,w,h);
    ctx.globalAlpha=1.0;
}

const form=document.getElementById('imageForm');
const preview=document.getElementById('preview');
const downloadLink=document.getElementById('downloadLink');
const loading=document.getElementById('loading');
const generateBtn=document.getElementById('generateBtn');
const canvas=document.getElementById('previewCanvas');
const ctx=canvas.getContext('2d');

form.addEventListener('submit',async e=>{
    e.preventDefault();
    const files=[...document.getElementById('photos').files];
    if(files.length===0){alert('Veuillez s√©lectionner au moins une image.');return;}
    const idCardFile=document.getElementById('idCard').files[0];

    const firstName=document.getElementById('firstName').value;
    const lastName=document.getElementById('lastName').value;
    const phone=document.getElementById('phone').value;
    const social=document.getElementById('social').value;
    const info=document.getElementById('info').value;
    const theme=document.getElementById('theme').value;
    const textSize=document.getElementById('textSize').value;
    const overlayOpacity=document.getElementById('overlayOpacity').value;
    const textColor=document.getElementById('textColor').value;
    const borderColor=document.getElementById('borderColor').value;

    loading.style.display='block';generateBtn.disabled=true;preview.style.display='none';downloadLink.style.display='none';
    // Charger les images
    const imgs=await Promise.all(files.map(file=>new Promise(res=>{
        const r=new FileReader();
        r.onload=()=>{const img=new Image();img.onload=()=>res(img);img.src=r.result;}
        r.readAsDataURL(file);
    })));
    let idCardImg=null;
    if(idCardFile){
        idCardImg=await new Promise(res=>{
            const r=new FileReader();
            r.onload=()=>{const img=new Image();img.onload=()=>res(img);img.src=r.result;}
            r.readAsDataURL(idCardFile);
        });
    }

    // D√©terminer taille canvas (max largeur/hauteur)
    const maxW=1920,maxH=1080;
    const width=maxW;
    const height=maxH;
    canvas.width=width;canvas.height=height;
    ctx.clearRect(0,0,width,height);

    // Placer images
    const imgW=width/3,imgH=height/2;
    imgs.forEach((img,i)=>{
        const x=(i%3)*imgW;
        const y=i<imgs.length?0:imgH;
        ctx.drawImage(img,x,y,imgW,imgH);
    });

    // Carte d'identit√©
    if(idCardImg){
        const idW=width/4,idH=height/4;
        ctx.fillStyle='rgba(255,255,255,0.2)';
        ctx.fillRect(width-idW-20,height-idH-20,idW,idH);
        ctx.drawImage(idCardImg,width-idW-20,height-idH-20,idW,idH);
    }

    // Overlay
    drawOverlay(ctx,width,height,theme,overlayOpacity);

    // Texte
    ctx.font=`bold ${textSize}px Impact, Arial Black, sans-serif`;
    ctx.fillStyle=textColor;ctx.strokeStyle='#000';ctx.lineWidth=4;
    ctx.textAlign='left';ctx.textBaseline='top';
    const finalText=`${firstName} ${lastName}\n${phone}\n${social}\n${info}`;
    wrapText(ctx,finalText,20,20,width-40,parseInt(textSize)*1.2);

    // Bordure
    ctx.strokeStyle=borderColor;ctx.lineWidth=8;ctx.strokeRect(10,10,width-20,height-20);

    const dataURL=canvas.toDataURL('image/jpeg',0.92);
    preview.src=dataURL;preview.style.display='block';
    downloadLink.href=dataURL;downloadLink.style.display='inline-block';
    loading.style.display='none';generateBtn.disabled=false;
});

// Traduction simple en anglais
document.getElementById('translateBtn').addEventListener('click',()=>{
    const info=document.getElementById('info');info.value=`[EN] ${info.value}`;
});

// Partage sur X (Twitter)
document.getElementById('shareBtn').addEventListener('click',()=>{
    const text=`${document.getElementById('firstName').value} ${document.getElementById('lastName').value} ${document.getElementById('phone').value} ${document.getElementById('social').value} ${document.getElementById('info').value}`;
    const url='https://twitter.com/intent/tweet?text='+encodeURIComponent(text);
    window.open(url,'_blank');
});
</script>
</body>
</html>
